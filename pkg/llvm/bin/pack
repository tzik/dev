#!/bin/bash
source "$(dirname "$0")/package.sh"
source "${toolchain_dir}/lib/install-cmake.sh"

bin_dir="${image_dir}${prefix}/bin"
wrap() {
  cat > "${bin_dir}/$1" <<EOF
#!/bin/bash
toolchain_dir="${toolchain_dir}"
prefix="\${toolchain_dir}/out/usr"
lib_dir="\${prefix}/lib"
export CCACHE_DIR="\${toolchain_dir}/ccache"
export CCACHE_HARDLINK=1
export CCACHE_COMPILERCHECK=none

if [ "\$#" -eq 0 ]; then
  exec "\${prefix}/bin/$2"
fi

exec ccache "\${prefix}/bin/$2" -Wno-unused-command-line-argument "\$@" -L\${lib_dir} -Wl,--rpath="\${lib_dir}"
EOF
  chmod a+x "${bin_dir}/$1"
}

wrap cc clang
wrap c++ clang++

source "${toolchain_dir}/lib/pack.sh"
